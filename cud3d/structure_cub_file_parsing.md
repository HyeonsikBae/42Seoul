# cub file parsing

---

cub3d는 .cub 파일에서 가져오는 정보들을 토대로 실행된다.

Mandatory에 따르면 .cub 파일에는 해상도, 각 방위의 텍스쳐, 스프라이트 텍스쳐, 천장과 바닥 색상, 그리고 맵 정보가 포함되어 있다.

file 확장자명, 파일의 유무를 확인하여 문제가 있을 경우 에러처리하였다.

처음엔 확장자명이 오는 위치의 각 문자를 일일이 확인했으나, 코드의 직관성을 위해 확장자명이 오는 위치의 문자열을 통째로 비교하도록 하였다.

```c
if (argv[1] + strlen(argv[1]) - 4 == '.' &&
	argv[1] + strlen(argv[1]) - 3 == 'c' &&
	argv[1] + strlen(argv[1]) - 2 == 'u' &&
	argv[1] + strlen(argv[1]) - 1 == 'b')
// 아래와 같이 변경
if (strncmp(argv[1] + strlen(argv[1]) - 4, ".cub", 4) == 0)
```

정상적인 상황의 경우, 1 Circle 에서 진행했던 get_next_line을 활용하여 각종 정보들을 각 구조체의 멤버변수 내 저장하였다.

R : 윈도우의 해상도 저장 (디바이스의 해상도보다 클 경우, 디바이스 최대 해상도로 저장)

SO, NO, EA, SE :  각 방위 텍스쳐를 img로 변환하여 저장

S : 스프라이트 텍스처를 img로 변환하여 저장

F, C : 바닥, 천장 색상을 rgb로 변환하여 저장

map : 이중 배열을 통해 map 정보 저장



F, C의 경우 r, g, b 각각의 값 (0 ~ 255)을 받아 TRGB 형태의 정수로 변환하는 것이 처음엔 쉽지 않았지만, 아래와 같이 비트연산을 통해 구현하였다.

```c
int			color = 0x00000000; //투명도, R, G, B

color = (color << 8) | (r & 0x000000ff); // red 추출
color = (color << 8) | (g & 0x000000ff); // green 추출
color = (color << 8) | (b & 0x000000ff); // blue 추출

return (color);
```



map의 경우, 공백도 map의 일부로 생각하고 알아서 판단하여 처리하라는 내용에 따라 이를 처리하였다.

공백도 0과 같이 통로로 판단하여 공백 값을 0으로 바꿔서 map 정보를 저장하였다.